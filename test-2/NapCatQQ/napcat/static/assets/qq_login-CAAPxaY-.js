import{h as j,j as i,R}from"./codemirror-core-vkcnXJgD.js";import{b as z,s as ve,C as Ne}from"./index-CRxYmROf.js";import{c as ye,a as Me}from"./chunk-5PILOUBS-0YCBWX_5.js";import{i as Y}from"./chunk-MLPFQTYO-BGSgsnSp.js";import{t as Re,a as $}from"./chunk-ML27DD5T-B8jMVnkz.js";import{D as I,x as be,C as Ae}from"./react-dom-Cz0lLOn1.js";import{l as Pe}from"./chunk-OPTZHMJX-C5BAZwJr.js";import{P as Se,H as je,t as J,T as Ie}from"./pure-0FsHNHi6.js";import{a as H}from"./chunk-SXMLSBOY-rqCh_0hQ.js";import{d as Qe,a as Le,b as ze,m as Oe}from"./chunk-KQ5CH2X7-DPs5JB78.js";import{i as ee}from"./chunk-2QAN2V2R-DUfyhebH.js";import{a as _e,b as ke,c as te}from"./index-B9v0kxJY.js";import{s as Te,l as De}from"./chunk-KVDW62ZT-7LdzXPwy.js";import{a as Fe}from"./index-CT80i5B1.js";import{Q as k}from"./qq_manager-OcYl2PUj.js";import{u as Ue}from"./use-dialog-Br2F93aG.js";import"./chunk-UX7UMZL5-D0R1-FPm.js";import"./index-CokAva9Y.js";import"./Item-CdZrGEbe.js";import"./chunk-EN4B57RQ-DpwResUR.js";import"./icons-D1JuxfCB.js";import"./chunk-6LIX6LVT-CxcHkZta.js";import"./chunk-WQVQ7P2I-BFZSGHT9.js";import"./chunk-2QQAR2RD-5fklPBbg.js";import"./chunk-FGM523TA-BJSiCD_V.js";import"./chunk-SLABUSGS-Dy5CjS7O.js";import"./chunk-M3MASYO7-Cm5fw87L.js";import"./iconBase-DqQMrcxU.js";import"./chunk-AXSF7SRE-CGODruUG.js";const T=c=>!!c&&"nickName"in c&&"faceUrl"in c,Be=({onSubmit:c,isLoading:a,qqList:o})=>{const[u,f]=j.useState(""),[d,C]=j.useState(""),g=()=>{if(!u){I.error("请输入QQ号");return}if(!d){I.error("请输入密码");return}c(u,d)};return i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx(Y,{className:"shadow-lg",height:100,radius:"full",src:`https://q1.qlogo.cn/g?b=qq&nk=${u||"0"}&s=100`,width:100,alt:"QQ Avatar"})}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx(ee,{type:"text",label:"QQ账号",placeholder:"请输入QQ号",value:u,onValueChange:f,variant:"bordered",size:"lg",autoComplete:"off",endContent:i.jsxs(Qe,{children:[i.jsx(Le,{children:i.jsx(z,{isIconOnly:!0,variant:"light",size:"sm",radius:"full",children:i.jsx(_e,{size:16})})}),i.jsx(ze,{"aria-label":"QQ Login History",items:o,onAction:e=>f(e.toString()),children:e=>i.jsx(Oe,{textValue:e.uin,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(H,{alt:e.uin,className:"flex-shrink-0",size:"sm",src:T(e)?e.faceUrl:`https://q1.qlogo.cn/g?b=qq&nk=${e.uin}&s=1`}),i.jsx("div",{className:"flex flex-col",children:T(e)?`${e.nickName}(${e.uin})`:e.uin})]})},e.uin)})]})}),i.jsx(ee,{type:"password",label:"密码",placeholder:"请输入密码",value:d,onValueChange:C,variant:"bordered",size:"lg",autoComplete:"new-password"})]}),i.jsx("div",{className:"flex justify-center mt-5",children:i.jsx(z,{className:"w-64 max-w-full",color:"primary",isLoading:a,radius:"full",size:"lg",variant:"shadow",onPress:g,children:"登录"})})]})};var $e=Object.defineProperty,B=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,se=(c,a,o)=>a in c?$e(c,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[a]=o,q=(c,a)=>{for(var o in a||(a={}))ne.call(a,o)&&se(c,o,a[o]);if(B)for(var o of B(a))oe.call(a,o)&&se(c,o,a[o]);return c},V=(c,a)=>{var o={};for(var u in c)ne.call(c,u)&&a.indexOf(u)<0&&(o[u]=c[u]);if(c!=null&&B)for(var u of B(c))a.indexOf(u)<0&&oe.call(c,u)&&(o[u]=c[u]);return o};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var O;(c=>{const a=class w{constructor(e,s,t,r){if(this.version=e,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],e<w.MIN_VERSION||e>w.MAX_VERSION)throw new RangeError("Version value out of range");if(r<-1||r>7)throw new RangeError("Mask value out of range");this.size=e*4+17;let n=[];for(let l=0;l<this.size;l++)n.push(!1);for(let l=0;l<this.size;l++)this.modules.push(n.slice()),this.isFunction.push(n.slice());this.drawFunctionPatterns();const h=this.addEccAndInterleave(t);if(this.drawCodewords(h),r==-1){let l=1e9;for(let p=0;p<8;p++){this.applyMask(p),this.drawFormatBits(p);const m=this.getPenaltyScore();m<l&&(r=p,l=m),this.applyMask(p)}}f(0<=r&&r<=7),this.mask=r,this.applyMask(r),this.drawFormatBits(r),this.isFunction=[]}static encodeText(e,s){const t=c.QrSegment.makeSegments(e);return w.encodeSegments(t,s)}static encodeBinary(e,s){const t=c.QrSegment.makeBytes(e);return w.encodeSegments([t],s)}static encodeSegments(e,s,t=1,r=40,n=-1,h=!0){if(!(w.MIN_VERSION<=t&&t<=r&&r<=w.MAX_VERSION)||n<-1||n>7)throw new RangeError("Invalid value");let l,p;for(l=t;;l++){const E=w.getNumDataCodewords(l,s)*8,v=C.getTotalBits(e,l);if(v<=E){p=v;break}if(l>=r)throw new RangeError("Data too long")}for(const E of[w.Ecc.MEDIUM,w.Ecc.QUARTILE,w.Ecc.HIGH])h&&p<=w.getNumDataCodewords(l,E)*8&&(s=E);let m=[];for(const E of e){o(E.mode.modeBits,4,m),o(E.numChars,E.mode.numCharCountBits(l),m);for(const v of E.getData())m.push(v)}f(m.length==p);const b=w.getNumDataCodewords(l,s)*8;f(m.length<=b),o(0,Math.min(4,b-m.length),m),o(0,(8-m.length%8)%8,m),f(m.length%8==0);for(let E=236;m.length<b;E^=253)o(E,8,m);let y=[];for(;y.length*8<m.length;)y.push(0);return m.forEach((E,v)=>y[v>>>3]|=E<<7-(v&7)),new w(l,s,y,n)}getModule(e,s){return 0<=e&&e<this.size&&0<=s&&s<this.size&&this.modules[s][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2==0),this.setFunctionModule(t,6,t%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),s=e.length;for(let t=0;t<s;t++)for(let r=0;r<s;r++)t==0&&r==0||t==0&&r==s-1||t==s-1&&r==0||this.drawAlignmentPattern(e[t],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const s=this.errorCorrectionLevel.formatBits<<3|e;let t=s;for(let n=0;n<10;n++)t=t<<1^(t>>>9)*1335;const r=(s<<10|t)^21522;f(r>>>15==0);for(let n=0;n<=5;n++)this.setFunctionModule(8,n,u(r,n));this.setFunctionModule(8,7,u(r,6)),this.setFunctionModule(8,8,u(r,7)),this.setFunctionModule(7,8,u(r,8));for(let n=9;n<15;n++)this.setFunctionModule(14-n,8,u(r,n));for(let n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,u(r,n));for(let n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,u(r,n));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;const s=this.version<<12|e;f(s>>>18==0);for(let t=0;t<18;t++){const r=u(s,t),n=this.size-11+t%3,h=Math.floor(t/3);this.setFunctionModule(n,h,r),this.setFunctionModule(h,n,r)}}drawFinderPattern(e,s){for(let t=-4;t<=4;t++)for(let r=-4;r<=4;r++){const n=Math.max(Math.abs(r),Math.abs(t)),h=e+r,l=s+t;0<=h&&h<this.size&&0<=l&&l<this.size&&this.setFunctionModule(h,l,n!=2&&n!=4)}}drawAlignmentPattern(e,s){for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,s+t,Math.max(Math.abs(r),Math.abs(t))!=1)}setFunctionModule(e,s,t){this.modules[s][e]=t,this.isFunction[s][e]=!0}addEccAndInterleave(e){const s=this.version,t=this.errorCorrectionLevel;if(e.length!=w.getNumDataCodewords(s,t))throw new RangeError("Invalid argument");const r=w.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][s],n=w.ECC_CODEWORDS_PER_BLOCK[t.ordinal][s],h=Math.floor(w.getNumRawDataModules(s)/8),l=r-h%r,p=Math.floor(h/r);let m=[];const b=w.reedSolomonComputeDivisor(n);for(let E=0,v=0;E<r;E++){let P=e.slice(v,v+p-n+(E<l?0:1));v+=P.length;const _=w.reedSolomonComputeRemainder(P,b);E<l&&P.push(0),m.push(P.concat(_))}let y=[];for(let E=0;E<m[0].length;E++)m.forEach((v,P)=>{(E!=p-n||P>=l)&&y.push(v[E])});return f(y.length==h),y}drawCodewords(e){if(e.length!=Math.floor(w.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let s=0;for(let t=this.size-1;t>=1;t-=2){t==6&&(t=5);for(let r=0;r<this.size;r++)for(let n=0;n<2;n++){const h=t-n,p=(t+1&2)==0?this.size-1-r:r;!this.isFunction[p][h]&&s<e.length*8&&(this.modules[p][h]=u(e[s>>>3],7-(s&7)),s++)}}f(s==e.length*8)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let s=0;s<this.size;s++)for(let t=0;t<this.size;t++){let r;switch(e){case 0:r=(t+s)%2==0;break;case 1:r=s%2==0;break;case 2:r=t%3==0;break;case 3:r=(t+s)%3==0;break;case 4:r=(Math.floor(t/3)+Math.floor(s/2))%2==0;break;case 5:r=t*s%2+t*s%3==0;break;case 6:r=(t*s%2+t*s%3)%2==0;break;case 7:r=((t+s)%2+t*s%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[s][t]&&r&&(this.modules[s][t]=!this.modules[s][t])}}getPenaltyScore(){let e=0;for(let n=0;n<this.size;n++){let h=!1,l=0,p=[0,0,0,0,0,0,0];for(let m=0;m<this.size;m++)this.modules[n][m]==h?(l++,l==5?e+=w.PENALTY_N1:l>5&&e++):(this.finderPenaltyAddHistory(l,p),h||(e+=this.finderPenaltyCountPatterns(p)*w.PENALTY_N3),h=this.modules[n][m],l=1);e+=this.finderPenaltyTerminateAndCount(h,l,p)*w.PENALTY_N3}for(let n=0;n<this.size;n++){let h=!1,l=0,p=[0,0,0,0,0,0,0];for(let m=0;m<this.size;m++)this.modules[m][n]==h?(l++,l==5?e+=w.PENALTY_N1:l>5&&e++):(this.finderPenaltyAddHistory(l,p),h||(e+=this.finderPenaltyCountPatterns(p)*w.PENALTY_N3),h=this.modules[m][n],l=1);e+=this.finderPenaltyTerminateAndCount(h,l,p)*w.PENALTY_N3}for(let n=0;n<this.size-1;n++)for(let h=0;h<this.size-1;h++){const l=this.modules[n][h];l==this.modules[n][h+1]&&l==this.modules[n+1][h]&&l==this.modules[n+1][h+1]&&(e+=w.PENALTY_N2)}let s=0;for(const n of this.modules)s=n.reduce((h,l)=>h+(l?1:0),s);const t=this.size*this.size,r=Math.ceil(Math.abs(s*20-t*10)/t)-1;return f(0<=r&&r<=9),e+=r*w.PENALTY_N4,f(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(this.version==1)return[];{const e=Math.floor(this.version/7)+2,s=this.version==32?26:Math.ceil((this.version*4+4)/(e*2-2))*2;let t=[6];for(let r=this.size-7;t.length<e;r-=s)t.splice(1,0,r);return t}}static getNumRawDataModules(e){if(e<w.MIN_VERSION||e>w.MAX_VERSION)throw new RangeError("Version number out of range");let s=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;s-=(25*t-10)*t-55,e>=7&&(s-=36)}return f(208<=s&&s<=29648),s}static getNumDataCodewords(e,s){return Math.floor(w.getNumRawDataModules(e)/8)-w.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e]*w.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let s=[];for(let r=0;r<e-1;r++)s.push(0);s.push(1);let t=1;for(let r=0;r<e;r++){for(let n=0;n<s.length;n++)s[n]=w.reedSolomonMultiply(s[n],t),n+1<s.length&&(s[n]^=s[n+1]);t=w.reedSolomonMultiply(t,2)}return s}static reedSolomonComputeRemainder(e,s){let t=s.map(r=>0);for(const r of e){const n=r^t.shift();t.push(0),s.forEach((h,l)=>t[l]^=w.reedSolomonMultiply(h,n))}return t}static reedSolomonMultiply(e,s){if(e>>>8||s>>>8)throw new RangeError("Byte out of range");let t=0;for(let r=7;r>=0;r--)t=t<<1^(t>>>7)*285,t^=(s>>>r&1)*e;return f(t>>>8==0),t}finderPenaltyCountPatterns(e){const s=e[1];f(s<=this.size*3);const t=s>0&&e[2]==s&&e[3]==s*3&&e[4]==s&&e[5]==s;return(t&&e[0]>=s*4&&e[6]>=s?1:0)+(t&&e[6]>=s*4&&e[0]>=s?1:0)}finderPenaltyTerminateAndCount(e,s,t){return e&&(this.finderPenaltyAddHistory(s,t),s=0),s+=this.size,this.finderPenaltyAddHistory(s,t),this.finderPenaltyCountPatterns(t)}finderPenaltyAddHistory(e,s){s[0]==0&&(e+=this.size),s.pop(),s.unshift(e)}};a.MIN_VERSION=1,a.MAX_VERSION=40,a.PENALTY_N1=3,a.PENALTY_N2=3,a.PENALTY_N3=40,a.PENALTY_N4=10,a.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],a.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],c.QrCode=a;function o(g,e,s){if(e<0||e>31||g>>>e)throw new RangeError("Value out of range");for(let t=e-1;t>=0;t--)s.push(g>>>t&1)}function u(g,e){return(g>>>e&1)!=0}function f(g){if(!g)throw new Error("Assertion error")}const d=class N{constructor(e,s,t){if(this.mode=e,this.numChars=s,this.bitData=t,s<0)throw new RangeError("Invalid argument");this.bitData=t.slice()}static makeBytes(e){let s=[];for(const t of e)o(t,8,s);return new N(N.Mode.BYTE,e.length,s)}static makeNumeric(e){if(!N.isNumeric(e))throw new RangeError("String contains non-numeric characters");let s=[];for(let t=0;t<e.length;){const r=Math.min(e.length-t,3);o(parseInt(e.substring(t,t+r),10),r*3+1,s),t+=r}return new N(N.Mode.NUMERIC,e.length,s)}static makeAlphanumeric(e){if(!N.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let s=[],t;for(t=0;t+2<=e.length;t+=2){let r=N.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t))*45;r+=N.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),o(r,11,s)}return t<e.length&&o(N.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,s),new N(N.Mode.ALPHANUMERIC,e.length,s)}static makeSegments(e){return e==""?[]:N.isNumeric(e)?[N.makeNumeric(e)]:N.isAlphanumeric(e)?[N.makeAlphanumeric(e)]:[N.makeBytes(N.toUtf8ByteArray(e))]}static makeEci(e){let s=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)o(e,8,s);else if(e<16384)o(2,2,s),o(e,14,s);else if(e<1e6)o(6,3,s),o(e,21,s);else throw new RangeError("ECI assignment value out of range");return new N(N.Mode.ECI,0,s)}static isNumeric(e){return N.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return N.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,s){let t=0;for(const r of e){const n=r.mode.numCharCountBits(s);if(r.numChars>=1<<n)return 1/0;t+=4+n+r.bitData.length}return t}static toUtf8ByteArray(e){e=encodeURI(e);let s=[];for(let t=0;t<e.length;t++)e.charAt(t)!="%"?s.push(e.charCodeAt(t)):(s.push(parseInt(e.substring(t+1,t+3),16)),t+=2);return s}};d.NUMERIC_REGEX=/^[0-9]*$/,d.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,d.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let C=d;c.QrSegment=d})(O||(O={}));(c=>{(a=>{const o=class{constructor(f,d){this.ordinal=f,this.formatBits=d}};o.LOW=new o(0,1),o.MEDIUM=new o(1,0),o.QUARTILE=new o(2,3),o.HIGH=new o(3,2),a.Ecc=o})(c.QrCode||(c.QrCode={}))})(O||(O={}));(c=>{(a=>{const o=class{constructor(f,d){this.modeBits=f,this.numBitsCharCount=d}numCharCountBits(f){return this.numBitsCharCount[Math.floor((f+7)/17)]}};o.NUMERIC=new o(1,[10,12,14]),o.ALPHANUMERIC=new o(2,[9,11,13]),o.BYTE=new o(4,[8,16,16]),o.KANJI=new o(8,[8,10,12]),o.ECI=new o(7,[0,0,0]),a.Mode=o})(c.QrSegment||(c.QrSegment={}))})(O||(O={}));var D=O;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var He={L:D.QrCode.Ecc.LOW,M:D.QrCode.Ecc.MEDIUM,Q:D.QrCode.Ecc.QUARTILE,H:D.QrCode.Ecc.HIGH},ie=128,ae="L",le="#FFFFFF",ce="#000000",ue=!1,de=1,qe=4,Ve=0,Ye=.1;function he(c,a=0){const o=[];return c.forEach(function(u,f){let d=null;u.forEach(function(C,g){if(!C&&d!==null){o.push(`M${d+a} ${f+a}h${g-d}v1H${d+a}z`),d=null;return}if(g===u.length-1){if(!C)return;d===null?o.push(`M${g+a},${f+a} h1v1H${g+a}z`):o.push(`M${d+a},${f+a} h${g+1-d}v1H${d+a}z`);return}C&&d===null&&(d=g)})}),o.join("")}function fe(c,a){return c.slice().map((o,u)=>u<a.y||u>=a.y+a.h?o:o.map((f,d)=>d<a.x||d>=a.x+a.w?f:!1))}function Ge(c,a,o,u){if(u==null)return null;const f=c.length+o*2,d=Math.floor(a*Ye),C=f/a,g=(u.width||d)*C,e=(u.height||d)*C,s=u.x==null?c.length/2-g/2:u.x*C,t=u.y==null?c.length/2-e/2:u.y*C,r=u.opacity==null?1:u.opacity;let n=null;if(u.excavate){let l=Math.floor(s),p=Math.floor(t),m=Math.ceil(g+s-l),b=Math.ceil(e+t-p);n={x:l,y:p,w:m,h:b}}const h=u.crossOrigin;return{x:s,y:t,h:e,w:g,excavation:n,opacity:r,crossOrigin:h}}function We(c,a){return a!=null?Math.max(Math.floor(a),0):c?qe:Ve}function me({value:c,level:a,minVersion:o,includeMargin:u,marginSize:f,imageSettings:d,size:C,boostLevel:g}){let e=R.useMemo(()=>{const l=(Array.isArray(c)?c:[c]).reduce((p,m)=>(p.push(...D.QrSegment.makeSegments(m)),p),[]);return D.QrCode.encodeSegments(l,He[a],o,void 0,void 0,g)},[c,a,o,g]);const{cells:s,margin:t,numCells:r,calculatedImageSettings:n}=R.useMemo(()=>{let h=e.getModules();const l=We(u,f),p=h.length+l*2,m=Ge(h,C,l,d);return{cells:h,margin:l,numCells:p,calculatedImageSettings:m}},[e,C,d,u,f]);return{qrcode:e,margin:t,cells:s,numCells:r,calculatedImageSettings:n}}var Xe=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),Ke=R.forwardRef(function(a,o){const u=a,{value:f,size:d=ie,level:C=ae,bgColor:g=le,fgColor:e=ce,includeMargin:s=ue,minVersion:t=de,boostLevel:r,marginSize:n,imageSettings:h}=u,p=V(u,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:m}=p,b=V(p,["style"]),y=h==null?void 0:h.src,E=R.useRef(null),v=R.useRef(null),P=R.useCallback(L=>{E.current=L,typeof o=="function"?o(L):o&&(o.current=L)},[o]),[_,U]=R.useState(!1),{margin:x,cells:M,numCells:S,calculatedImageSettings:A}=me({value:f,level:C,minVersion:t,boostLevel:r,includeMargin:s,marginSize:n,imageSettings:h,size:d});R.useEffect(()=>{if(E.current!=null){const L=E.current,Q=L.getContext("2d");if(!Q)return;let W=M;const F=v.current,X=A!=null&&F!==null&&F.complete&&F.naturalHeight!==0&&F.naturalWidth!==0;X&&A.excavation!=null&&(W=fe(M,A.excavation));const K=window.devicePixelRatio||1;L.height=L.width=d*K;const Z=d/S*K;Q.scale(Z,Z),Q.fillStyle=g,Q.fillRect(0,0,S,S),Q.fillStyle=e,Xe?Q.fill(new Path2D(he(W,x))):M.forEach(function(Ee,we){Ee.forEach(function(xe,Ce){xe&&Q.fillRect(Ce+x,we+x,1,1)})}),A&&(Q.globalAlpha=A.opacity),X&&Q.drawImage(F,A.x+x,A.y+x,A.w,A.h)}}),R.useEffect(()=>{U(!1)},[y]);const pe=q({height:d,width:d},m);let G=null;return y!=null&&(G=R.createElement("img",{src:y,key:y,style:{display:"none"},onLoad:()=>{U(!0)},ref:v,crossOrigin:A==null?void 0:A.crossOrigin})),R.createElement(R.Fragment,null,R.createElement("canvas",q({style:pe,height:d,width:d,ref:P,role:"img"},b)),G)});Ke.displayName="QRCodeCanvas";var ge=R.forwardRef(function(a,o){const u=a,{value:f,size:d=ie,level:C=ae,bgColor:g=le,fgColor:e=ce,includeMargin:s=ue,minVersion:t=de,boostLevel:r,title:n,marginSize:h,imageSettings:l}=u,p=V(u,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:m,cells:b,numCells:y,calculatedImageSettings:E}=me({value:f,level:C,minVersion:t,boostLevel:r,includeMargin:s,marginSize:h,imageSettings:l,size:d});let v=b,P=null;l!=null&&E!=null&&(E.excavation!=null&&(v=fe(b,E.excavation)),P=R.createElement("image",{href:l.src,height:E.h,width:E.w,x:E.x+m,y:E.y+m,preserveAspectRatio:"none",opacity:E.opacity,crossOrigin:E.crossOrigin}));const _=he(v,m);return R.createElement("svg",q({height:d,width:d,viewBox:`0 0 ${y} ${y}`,ref:o,role:"img"},p),!!n&&R.createElement("title",null,n),R.createElement("path",{fill:g,d:`M0,0 h${y}v${y}H0z`,shapeRendering:"crispEdges"}),R.createElement("path",{fill:e,d:_,shapeRendering:"crispEdges"}),P)});ge.displayName="QRCodeSVG";const Ze=({qrcode:c,loginError:a,onRefresh:o})=>i.jsx("div",{className:"flex flex-col items-center",children:a?i.jsxs("div",{className:"flex flex-col items-center py-4",children:[i.jsx("div",{className:"w-full flex justify-center mb-6",children:i.jsx("div",{className:"p-4 bg-danger-50 rounded-full",children:i.jsx(ke,{className:"text-danger",size:64})})}),i.jsxs("div",{className:"text-center space-y-2 px-4",children:[i.jsx("div",{className:"text-xl font-bold text-danger",children:"登录失败"}),i.jsx("div",{className:"text-default-600 text-sm leading-relaxed max-w-[300px]",children:a})]}),o&&i.jsx(z,{className:"mt-8 min-w-[160px]",variant:"solid",color:"primary",size:"lg",startContent:i.jsx(te,{}),onPress:o,children:"重新获取二维码"})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-white p-2 rounded-md w-fit mx-auto relative overflow-hidden",children:[!c&&i.jsx("div",{className:"absolute left-0 top-0 right-0 bottom-0 bg-white dark:bg-zinc-900 bg-opacity-90 backdrop-blur-sm flex items-center justify-center z-10",children:i.jsx(ve,{color:"primary"})}),i.jsx(ge,{size:180,value:c||" "})]}),i.jsx("div",{className:"mt-5 text-center text-default-500 text-sm",children:"请使用QQ或者TIM扫描上方二维码"}),o&&c&&i.jsx(z,{className:"mt-4",variant:"flat",color:"primary",size:"sm",startContent:i.jsx(te,{}),onPress:o,children:"刷新二维码"})]})}),Je=({qqList:c,refresh:a,isLoading:o,selectedQQ:u,onUpdateQQList:f,handleSelectionChange:d,onSubmit:C})=>i.jsxs("div",{className:"flex flex-col gap-8",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx(Y,{className:"shadow-lg",height:100,radius:"full",src:`https://q1.qlogo.cn/g?b=qq&nk=${u||"0"}&s=100`,width:100})}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Te,{classNames:{popoverContent:"bg-opacity-50 backdrop-blur"},"aria-label":"QQ Login",isDisabled:a,items:c,placeholder:"请选择QQ",renderValue:g=>g.map(e=>{var s,t,r,n;return i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(H,{alt:(s=e.key)==null?void 0:s.toString(),className:"flex-shrink-0",size:"sm",src:T(e.data)?(t=e.data)==null?void 0:t.faceUrl:`https://q1.qlogo.cn/g?b=qq&nk=${e.key}&s=1`}),i.jsx("div",{className:"flex flex-col",children:T(e.data)?`${e.data.nickName}(${(r=e.key)==null?void 0:r.toString()})`:(n=e.key)==null?void 0:n.toString()})]},e.key)}),selectedKeys:[u],size:"lg",onChange:d,children:g=>i.jsx(De,{textValue:g.uin,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(H,{alt:g.uin,className:"flex-shrink-0",size:"sm",src:T(g)?g.faceUrl:`https://q1.qlogo.cn/g?b=qq&nk=${g.uin}&s=1`}),i.jsx("div",{className:"flex flex-col",children:T(g)?`${g.nickName}(${g.uin})`:g.uin})]})},g.uin)}),i.jsx(z,{isIconOnly:!0,className:"flex-grow-0 flex-shrink-0",color:"secondary",isLoading:a,radius:"full",size:"lg",variant:"light",onPress:f,children:i.jsx(Fe,{size:24})})]}),i.jsx("div",{className:"flex justify-center mt-5",children:i.jsx(z,{className:"w-64 max-w-full",color:"primary",isLoading:o,radius:"full",size:"lg",variant:"shadow",onPress:C,children:"登录"})})]}),re=c=>{if(c.startsWith("登录失败: ")){const a=c.substring(6);try{const o=JSON.parse(a);if(Array.isArray(o)&&o[1]){const u=o[1],f=u.serverErrorCode?` (错误码: ${u.serverErrorCode})`:"";return`${u.message||c}${f}`}}catch{}}return c};function It(){const c=be(),a=Ue(),[o,u]=j.useState(""),[f,d]=j.useState(!1),[C,g]=j.useState(""),[e,s]=j.useState(""),t=j.useRef(""),[r,n]=j.useState([]),[h,l]=j.useState(!1),[p,m]=j.useState("shortcut"),b=j.useRef(!0),y=async()=>{if(!o){I.error("请选择快捷登录的QQ");return}d(!0);try{await k.setQuickLogin(o)}catch(x){const M=x.message;I.error(`快速登录QQ失败: ${M}`)}finally{setTimeout(()=>{d(!1)},1e3)}},E=async(x,M)=>{d(!0);try{const S=Ne.MD5(M).toString();await k.passwordLogin(x,S),I.success("密码登录请求已发送")}catch(S){const A=S.message;I.error(`密码登录失败: ${A}`)}finally{d(!1)}},v=async()=>{b.current&&d(!0);try{const x=await k.checkQQLoginStatusWithQrcode();if(b.current&&(d(!1),b.current=!1),x.isLogin)I.success("QQ登录成功"),c("/",{replace:!0});else if(g(x.qrcodeurl),x.loginError&&x.loginError!==t.current){t.current=x.loginError,s(x.loginError);const M=re(x.loginError);(!(M.includes("二维码")&&(M.includes("过期")||M.includes("失效")))||p==="qrcode")&&a.alert({title:"登录失败",content:M,confirmText:"确定"})}else x.loginError||(t.current="",s(""))}catch(x){const M=x.message;I.error(`获取二维码失败: ${M}`)}},P=async()=>{l(!0);try{const x=await k.getQQQuickLoginListNew();n(x)}catch{try{const S=(await k.getQQQuickLoginList()).map(A=>({uin:A}));n(S)}catch(M){const S=M.message;I.error(`获取QQ列表失败: ${S}`)}}finally{l(!1)}},_=x=>{u(x.target.value)},U=async()=>{try{t.current="",s(""),await k.refreshQRCode(),I.success("已发送刷新请求")}catch(x){const M=x.message;I.error(`刷新二维码失败: ${M}`)}};return j.useEffect(()=>{const x=setInterval(()=>{v()},3e3);return v(),P(),()=>clearInterval(x)},[]),i.jsxs(i.Fragment,{children:[i.jsx("title",{children:"QQ登录 - NapCat WebUI"}),i.jsx(Se,{children:i.jsx(Ae.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.5,type:"spring",stiffness:120,damping:20},className:"w-[608px] max-w-full py-8 px-2 md:px-8 overflow-hidden",children:i.jsxs(je,{className:"items-center gap-4 pt-0 pb-6 bg-default-50",maxXRotation:3,maxYRotation:3,children:[i.jsxs(ye,{className:"inline-block max-w-lg text-center justify-center",children:[i.jsxs("div",{className:"flex items-center justify-center w-full gap-2 pt-10",children:[i.jsx(Y,{alt:"logo",height:"7em",src:Pe}),i.jsxs("div",{children:[i.jsx("span",{className:J(),children:"Web "}),i.jsx("span",{className:J({color:"violet"}),children:"Login "})]})]}),i.jsx(Ie,{className:"absolute right-4 top-4"})]}),i.jsxs(Me,{className:"flex gap-5 p-10 pt-0",children:[i.jsxs(Re,{fullWidth:!0,classNames:{tabList:"shadow-sm dark:shadow-none"},isDisabled:f,size:"lg",selectedKey:p,onSelectionChange:x=>x!==null&&m(x.toString()),children:[i.jsx($,{title:"快速登录",children:i.jsx(Je,{handleSelectionChange:_,isLoading:f,qqList:r,refresh:h,selectedQQ:o,onSubmit:y,onUpdateQQList:P})},"shortcut"),i.jsx($,{title:"密码登录",children:i.jsx(Be,{isLoading:f,onSubmit:E,qqList:r})},"password"),i.jsx($,{title:"扫码登录",children:i.jsx(Ze,{loginError:re(e),qrcode:C,onRefresh:U})},"qrcode")]}),i.jsx(z,{className:"w-fit mx-auto",variant:"light",color:"primary",onPress:()=>{c("/web_login",{replace:!0})},children:"返回 Web Login"})]})]})})})]})}export{It as default};
