import{h as a,j as s}from"./codemirror-core-vkcnXJgD.js";import{t as w,a as P}from"./chunk-ML27DD5T-B8jMVnkz.js";import{P as v,b as k,s as I}from"./index-CRxYmROf.js";import{J as y}from"./react-dom-Cz0lLOn1.js";import{a as $}from"./index-CT80i5B1.js";import{n as x}from"./index-Ct0bcwxX.js";import{P as E}from"./plugin_manager-BHhkeCxq.js";import"./chunk-UX7UMZL5-D0R1-FPm.js";import"./index-CokAva9Y.js";import"./Item-CdZrGEbe.js";import"./iconBase-DqQMrcxU.js";function J(){const[o,c]=a.useState(!0),[i,d]=a.useState([]),[n,m]=a.useState(""),[f,u]=a.useState(!1),p=async()=>{var e;c(!0);try{const t=await E.getPluginList();t.pluginManagerNotFound?d([]):(d(t.extensionPages||[]),((e=t.extensionPages)==null?void 0:e.length)>0&&!n&&m(`${t.extensionPages[0].pluginId}:${t.extensionPages[0].path}`))}catch(t){const l=t.message;y.error(`获取扩展页面失败: ${l}`)}finally{c(!1)}},g=async()=>{await p()},h=a.useMemo(()=>i.map(e=>({key:`${e.pluginId}:${e.path}`,title:e.title,pluginId:e.pluginId,pluginName:e.pluginName,path:e.path,icon:e.icon,description:e.description})),[i]),r=a.useMemo(()=>{if(!n)return"";const[e,...t]=n.split(":"),l=t.join(":").replace(/^\//,"");return`/plugin/${e}/page/${l}`},[n]);a.useEffect(()=>{p()},[]),a.useEffect(()=>{r&&u(!0)},[r]);const b=()=>{u(!1)},j=(e,t)=>{const l=t.replace(/^\//,""),N=`/plugin/${e}/page/${l}`;window.open(N,"_blank")};return s.jsxs(s.Fragment,{children:[s.jsx("title",{children:"扩展页面 - NapCat WebUI"}),s.jsxs("div",{className:"p-2 md:p-4 relative h-[calc(100vh-6rem)] md:h-[calc(100vh-4rem)] flex flex-col",children:[s.jsx(v,{loading:o}),s.jsxs("div",{className:"flex mb-4 items-center justify-between gap-4 flex-wrap",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-default-600",children:[s.jsx(x,{size:24}),s.jsx("span",{className:"text-lg font-medium",children:"插件扩展页面"})]}),s.jsx(k,{isIconOnly:!0,className:"bg-default-100/50 hover:bg-default-200/50 text-default-700 backdrop-blur-md",radius:"full",onPress:g,children:s.jsx($,{size:24})})]}),i.length>0&&s.jsx(w,{"aria-label":"Extension Pages",className:"max-w-full",selectedKey:n,onSelectionChange:e=>m(e),classNames:{tabList:"bg-white/40 dark:bg-black/20 backdrop-blur-md",cursor:"bg-white/80 dark:bg-white/10 backdrop-blur-md shadow-sm",panel:"hidden"},children:h.map(e=>s.jsx(P,{title:s.jsxs("div",{className:"flex items-center gap-2",children:[e.icon&&s.jsx("span",{children:e.icon}),s.jsx("span",{className:"cursor-pointer hover:underline truncate max-w-[6rem] md:max-w-none",title:`插件：${e.pluginName}
点击在新窗口打开`,onClick:t=>{t.stopPropagation(),j(e.pluginId,e.path)},children:e.title}),s.jsxs("span",{className:"text-xs text-default-400 hidden md:inline",children:["(",e.pluginName,")"]})]})},e.key))})]}),i.length===0&&!o?s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-default-400",children:[s.jsx(x,{size:64,className:"mb-4 opacity-50"}),s.jsx("p",{className:"text-lg",children:"暂无插件扩展页面"}),s.jsx("p",{className:"text-sm mt-2",children:"插件可以通过注册页面来扩展 WebUI 功能"})]}):s.jsxs("div",{className:"flex-1 min-h-0 bg-white/40 dark:bg-black/20 backdrop-blur-md rounded-lg overflow-hidden relative",children:[f&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-default-100/50 z-10",children:s.jsx(I,{size:"lg"})}),s.jsx("iframe",{src:r,className:"w-full h-full border-0",onLoad:b,title:"extension-page",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups"})]})]})]})}export{J as default};
