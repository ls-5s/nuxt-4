# Nuxt 4 服务端常用 h3 方法/属性汇总表
所有方法/属性均**无需手动导入**，可直接在 `server/` 目录（`api/`/`routes/`/`middleware/` 等）的 `defineEventHandler` 处理函数中使用，覆盖99%服务端开发场景，按**使用频率+功能分类**整理，示例贴合实际业务。

| 分类           | 方法/属性                   | 核心作用                                                     | 适用场景                      | 极简使用示例                                                             | 关键注意点                     |
| -------------- | --------------------------- | ------------------------------------------------------------ | ----------------------------- | ------------------------------------------------------------------------ | ------------------------------ |
| **参数获取**   | `getRouterParams(event)`    | 获取服务端动态路由参数（替代弃用的 `event.context.params`）  | `[id].ts`/`[userId]` 动态接口 | `const { id, userId } = getRouterParams(event)`                          | 参数值均为字符串，需手动转类型 |
| **参数获取**   | `getQuery(event)`           | 解析URL查询参数（`?`后键值对）为对象，支持多值参数转数组     | 分页/筛选/非核心参数传递      | `const { page, size, keyword } = getQuery(event)`                        | 自动处理特殊字符，无需手动解析 |
| **参数获取**   | `readBody(event)`           | 解析POST/PUT/PATCH请求体，自动适配JSON/表单数据              | 登录/提交/更新类接口          | `const { username, pwd } = await readBody(event)`                        | 异步方法，必须配合 `await`     |
| **请求判断**   | `getMethod(event)`          | 获取当前HTTP请求方法（大写：GET/POST/PUT/DELETE/PATCH）      | 单文件多方法接口逻辑区分      | `if (getMethod(event) === 'POST') { /* 提交逻辑 */ }`                    | 返回纯字符串，严格匹配         |
| **请求判断**   | `event.path`                | 获取请求**纯路径**（标准化，无查询参数，自动去末尾`/`）      | 路由判断/权限校验/404兜底     | `if (event.path.startsWith('/api/admin')) { /* 管理员校验 */ }`          | 服务端开发**优先使用**         |
| **请求判断**   | `event.url`                 | 获取请求**完整路径**（原始字符串，含查询参数）               | 日志记录/第三方接口转发       | `console.log('完整请求：', event.url)`                                   | 不包含域名/端口，无需手动解析  |
| **请求判断**   | `isMethod(event, method)`   | 判断请求是否为指定方法（支持单方法/数组），返回布尔值        | 批量方法判断                  | `if (isMethod(event, ['POST', 'PUT'])) { /* 提交/更新 */ }`              | 方法名大小写不敏感             |
| **响应处理**   | 直接返回对象/字符串         | 最简响应方式，自动设置响应头（JSON自动加`application/json`） | 90%接口正常数据返回           | `return { code:200, msg:'成功', data:[] }` / `return '操作成功'`         | 支持HTML字符串，需手动设响应头 |
| **响应处理**   | `sendRedirect(event, url)`  | 重定向请求到指定URL，默认302临时重定向，可选自定义状态码     | 登录后跳转/旧接口迁移         | `sendRedirect(event, '/login')` / `sendRedirect(event, '/new-api', 301)` | 第二个参数为目标完整路径       |
| **响应处理**   | `setHeader(event, k, v)`    | 手动设置单个响应头，覆盖框架默认配置                         | 自定义内容类型/跨域配置       | `setHeader(event, 'Content-Type', 'text/html; charset=utf-8')`           | 键值对均为字符串               |
| **错误处理**   | `createError(options)`      | 创建标准化错误对象，支持状态码/错误信息/自定义字段           | 所有异常场景统一错误格式      | `createError({ statusCode:404, msg:'接口不存在' })`                      | 仅创建对象，需抛出/传递        |
| **错误处理**   | 直接抛出`createError`       | 简化错误响应，Nuxt自动捕获并返回前端，无需调用`sendError`    | 所有异常场景（**推荐**）      | `throw createError({ statusCode:401, msg:'未登录' })`                    | 最简洁，服务端开发首选         |
| **Cookie操作** | `getCookie(event, name)`    | 获取指定名称的Cookie值，自动解析编码                         | 获取登录态/临时标识           | `const token = getCookie(event, 'token')`                                | 未找到返回 `undefined`         |
| **Cookie操作** | `setCookie(event, k, v, o)` | 设置Cookie，支持自定义过期时间/HttpOnly/路径等配置           | 保存登录态/临时数据           | `setCookie(event, 'token', 'xxx', { maxAge:86400, httpOnly:true })`      | `httpOnly:true` 防XSS攻击      |
| **Cookie操作** | `deleteCookie(event, name)` | 删除指定Cookie，需与设置时的domain/path一致                  | 退出登录/清除临时数据         | `deleteCookie(event, 'token')`                                           | 需保证配置与设置时一致         |
| **其他工具**   | `getHeaders(event)`         | 获取当前请求所有请求头，返回键值对对象                       | 获取请求来源/Token/IP相关     | `const token = getHeaders(event)['authorization']`                       | 头名称大小写不敏感             |
| **其他工具**   | `getClientIP(event)`        | 获取客户端真实IP，自动解析反向代理头（Nginx/Apache）         | 日志记录/地域限制/风控        | `const clientIp = getClientIP(event)`                                    | 部署时需配置反向代理透传IP     |

## 核心通用规则（所有方法/属性均适用）
1. **使用范围**：仅服务端 `server/` 目录可用，前端组件/页面不可调用，调用会直接报错；
2. **event参数**：所有方法均需将 `defineEventHandler` 的 `event` 上下文作为第一个参数传入，不可省略；
3. **类型统一**：所有从请求中获取的参数（params/query/cookie）**默认均为字符串类型**，数字/布尔值需手动转换；
4. **异常安全**：框架已做异常处理，参数不存在时返回 `undefined`，不会直接报错，建议解构时设置默认值（如 `const { page = 1 } = getQuery(event)`）；
5. **前后端对应**：与前端参数获取方法规则一致（如服务端 `getRouterParams` 对应前端 `useRouteParams`），无需额外记忆。

## 高频组合用法示例（直接复用）
### 1. 标准接口（GET + 分页参数）
```ts
// server/api/article/list.ts
export default defineEventHandler(async (event) => {
  // 获取分页查询参数，转数字+默认值
  const { page = 1, size = 10, keyword = '' } = getQuery(event);
  // 业务逻辑
  return {
    code: 200,
    msg: '查询成功',
    data: {
      list: [],
      total: 0,
      page: Number(page),
      size: Number(size)
    }
  };
});
```

### 2. 标准接口（POST + 数据提交 + 错误处理）
```ts
// server/api/user/login.ts
export default defineEventHandler(async (event) => {
  // 获取POST请求体
  const { username, password } = await readBody(event);
  // 参数校验
  if (!username || !password) {
    throw createError({ statusCode:400, msg:'账号/密码不能为空' });
  }
  // 业务逻辑（校验账号/生成Token）
  const token = 'xxx-xxx-xxx';
  // 设置登录Cookie
  setCookie(event, 'token', token, { maxAge: 86400 * 7, httpOnly: true });
  // 返回结果
  return { code:200, msg:'登录成功', data: { token, username } };
});
```

### 3. 动态路由接口（参数获取 + 类型转换）
```ts
// server/api/order/[orderNo].ts
export default defineEventHandler(async (event) => {
  // 获取动态路由参数
  const { orderNo } = getRouterParams(event);
  // 类型校验
  if (!orderNo) {
    throw createError({ statusCode:400, msg:'订单号不能为空' });
  }
  // 业务逻辑（查询订单）
  return { code:200, msg:'查询成功', data: { orderNo, status: '已支付' } };
});
```

### 4. 服务端404兜底（捕获所有路由）
```ts
// server/api/[...].ts
export default defineEventHandler(async (event) => {
  // 记录未匹配接口日志
  console.log('未匹配API请求：', event.path, event.url);
  // 返回标准化404响应
  return { code:404, msg:`接口不存在：${event.path}`, data: null };
});
```